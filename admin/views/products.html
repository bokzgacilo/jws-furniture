<script>
  $('#productDescription').richText({
    fonts: false,
    table: false,
    underline: false,
    urls: false,
    leftAlign: false,
    centerAlign: false,
    rightAlign: false,
    justify: false,
    videoEmbed: false,
    imageUpload: false,
    fileUpload: false,
    removeStyles: false
  });
</script>

<style>
  .item-viewer {
    display: grid;
    grid-template-columns: 40% 60%;
    gap: 1rem;
  }

  .viewer {
    display: flex;
    flex-direction: column; 
  }

  .viewer > img {
    width: 250px;
    height: 250px;
    object-fit: cover;
  }

  #addProduct {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .fr-second-toolbar {
    display: none;
  }

  .fr-box.fr-basic .fr-wrapper {
    border-bottom-color: #CCCCCC;
  }
</style>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Add Product</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="addProduct" method="post"  enctype="multipart/form-data">
          <input required id="productName" type="text" class="form-control" placeholder="Name"/>
          <input required id="productPrice" type="number" class="form-control" placeholder="Pricing"/>
          <textarea required id="productDescription"></textarea>
          <select required id="productCategory" class="form-control">
            <option>Chair</option>
            <option>Table</option>
            <option>Door</option>
            <option>Window</option>
            <option>Cabinet</option>
          </select>
          <h6>Upload image for the product</h6>
          <input accept="image/*" required id="productImage" class="form-control" type="file" />
          <button type="submit" class="btn btn-primary w-25">Add Product</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="productViewCanvas" aria-labelledby="productViewCanvasLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="productViewCanvasLabel">Backdrop with scrolling</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <p>Try scrolling the rest of the page to see this option in action.</p>
  </div>
</div>

<h4>Products</h4>

<div>
  <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal">Add Product</button>
  <button class="btn btn-danger btn-sm">Delete Product</button>
</div>
<div class="item-viewer">
  <div class="custom-table" style="width:100%">
    <div class="t-header">
      <p class="col-1">ID</p>
      <p class="col">Name</p>
      <p class="col-1">Price</p>
      <!-- <p class="col">Description</p> -->
    </div>
    <div class="t-body">
      <div class="t-data">
        <p class="col">Fetching data...</p>
      </div>
    </div>
  </div>
  <div class="viewer" style="width:100%">
    
  </div>
</div>


<script>
  function getAllProducts(){
    $.ajax({
      type: 'get',
      url: 'api/getAllProducts.php',
      success: (response) => {
        $('.t-body').html(response)
      }
    })
  }

  function viewImage(id){
    window.history.replaceState(null, null, `?id=${id}`);

    $.ajax({
      type: 'get',
      url: 'api/getItem.php',
      data: {
        id: id
      },
      beforeSend: () => {
        $('.viewer').html('<p>Loading Item...</p>')
      },
      success: (response) => {
        $('.viewer').html(response)
      }
    })
  }
  
  $(document).ready(function(){
    if(location.search != ""){
      let params = new URL(document.location).searchParams;
      var productID = params.get('id');
      viewImage(productID)
    }

    getAllProducts()

    $('#addProduct').on('submit', function(event){
      event.preventDefault();

      var formdata = new FormData();
    
      var name = $("#productName").val();
      var price = $("#productPrice").val();
      var description = $("#productDescription").val();
      var category = $("#productCategory").val();
      var image = $("#productImage").prop("files")[0];

      formdata.append("name", name);
      formdata.append("price", price);
      formdata.append("description", description);
      formdata.append("category", category);
      formdata.append("image", image);

      $.ajax({
        type: 'post',
        url: 'api/addproduct.php',
        data: formdata,
        contentType: false,
        cache: false,
        processData:false,
        success: (response) => {
          console.log(response)
          location.reload();
        }
      })
    })
  })
</script>